<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Dashboard</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary-orange': '#fe5304',
                        'bg-dark': '#333333',
                        'bg-light': '#f8f8f8',
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
</head>
<body class="flex flex-col md:flex-row min-h-screen bg-bg-light">

    <nav id="sidebar" class="w-full md:w-56 bg-bg-dark text-white p-4 md:p-6 shadow-xl flex flex-col justify-between">
        <div>
            <h2 class="text-3xl font-extrabold text-primary-orange mb-6 border-b border-gray-700 pb-3">
                Dash
            </h2>

            <div class="space-y-2">
                <a href="#" class="block p-3 rounded-lg hover:bg-gray-700 transition duration-200 font-medium flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-3"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
                    Home
                </a>
                <a href="#" class="block p-3 rounded-lg hover:bg-gray-700 transition duration-200 font-medium flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-3"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                    Profile
                </a>
                <a href="#" class="block p-3 rounded-lg hover:bg-gray-700 transition duration-200 font-medium flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-3"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 0-2 0l-.15-.08a2 2 0 0 0-2.73 2.73l.08.15a2 2 0 0 0 0 2l-.25.43a2 2 0 0 0-.18 1H2a2 2 0 0 0-2 2v.44a2 2 0 0 0 2 2h.18a2 2 0 0 1 1.73 1l.25.43a2 2 0 0 0 0 2l-.08.15a2 2 0 0 0 2.73 2.73l.15-.08a2 2 0 0 0 2 0l.43-.25a2 2 0 0 1 1-1.73V22a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 0 2 0l.15.08a2 2 0 0 0 2.73-2.73l-.08-.15a2 2 0 0 0 0-2l.25-.43a2 2 0 0 0 .18-1h.18a2 2 0 0 0 2-2v-.44a2 2 0 0 0-2-2h-.18a2 2 0 0 1-1.73-1l-.25-.43a2 2 0 0 0 0-2l.08-.15a2 2 0 0 0-2.73-2.73l-.15.08a2 2 0 0 0-2 0l-.43.25a2 2 0 0 1-1 1.73z"/><circle cx="12" cy="12" r="3"/></svg>
                    Settings
                </a>
                <a href="#" class="block p-3 rounded-lg hover:bg-gray-700 transition duration-200 font-medium flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-3"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 0-2 0l-.15-.08a2 2 0 0 0-2.73 2.73l.08.15a2 2 0 0 0 0 2l-.25.43a2 2 0 0 0-.18 1H2a2 2 0 0 0-2 2v.44a2 2 0 0 0 2 2h.18a2 2 0 0 1 1.73 1l.25.43a2 2 0 0 0 0 2l-.08.15a2 2 0 0 0 2.73 2.73l.15-.08a2 2 0 0 0 2 0l.43-.25a2 2 0 0 1 1-1.73V22a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 0 2 0l.15.08a2 2 0 0 0 2.73-2.73l-.08-.15a2 2 0 0 0 0-2l.25-.43a2 2 0 0 0 .18-1h.18a2 2 0 0 0 2-2v-.44a2 2 0 0 0-2-2h-.18a2 2 0 0 1-1.73-1l-.25-.43a2 2 0 0 0 0-2l.08-.15a2 2 0 0 0-2.73-2.73l-.15.08a2 2 0 0 0-2 0l-.43.25a2 2 0 0 1-1 1.73z"/><circle cx="1" cy="12" r="3"/></svg>
                    table of content
                </a>
            </div>
        </div>

        <a href="index.html" onclick="handleLogout(event)" class="mt-8 p-3 rounded-lg bg-red-600 hover:bg-red-700 transition duration-200 font-bold flex items-center justify-center shadow-lg">
             <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" x2="9" y1="12" y2="12"/></svg>
            Logout
        </a>
    </nav>

    <div class="flex-1 p-4 md:p-8 overflow-y-auto">
        <header class="bg-primary-orange text-white p-6 rounded-xl text-center mb-8 shadow-xl">
            <h1 class="text-3xl md:text-4xl font-extrabold tracking-tight">
                Welcome to Your Dashboard
            </h1>
        </header>

        <div class="bg-white p-6 rounded-lg border-l-4 border-primary-orange shadow-md mb-8">
            <p class="text-xl font-semibold text-gray-800">
                Hello, user!
            </p>
            <p class="text-gray-600 mt-2">
                Here is your dashboard where you can manage your account and settings.
            </p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <div id="metrics-card" class="bg-white p-6 rounded-xl shadow-lg border border-gray-100">
                <h3 id="metric-title" class="text-xl font-bold text-primary-orange mb-2">Loading...</h3>
                <p id="metric-value" class="text-4xl font-light text-gray-900">...</p>
                <p class="text-sm text-gray-500 mt-2">Data points collected this week.</p>
            </div>

            <div id = "phone-card" class="bg-white p-6 rounded-xl shadow-lg border border-gray-100">
                <h3 id="phone-title" class="text-xl font-bold text-primary-orange mb-2"></h3>
                <p id ="phone-value" class="text-4xl font-light text-gray-900"></p>
                <p class="text-sm text-gray-500 mt-2">.</p>
            </div>

            <div id = "position" class="bg-white p-6 rounded-xl shadow-lg border border-gray-100">
                <h3 class="text-xl font-bold text-primary-orange mb-2">position</h3>
                <p class="text-4xl font-light text-gray-900">2</p>
                <p class="text-sm text-gray-500 mt-2"></p>
            </div>
            <div id ="status" class="bg-white p-6 rounded-xl shadow-lg border border-gray-100">
                <h3 class="text-xl font-bold text-primary-orange mb-2">status</h3>
                <p class="text-4xl font-light text-gray-900">2</p>
                <p class="text-sm text-gray-500 mt-2">Always on the look out</p>
            </div>
        </div>

    </div>
    <!-- AddPanale Panel: create/update/list/delete -->
    <div class="flex-1 p-4 md:p-8 overflow-y-auto">
        <section class="bg-white p-6 rounded-lg border border-gray-100 shadow-md my-6">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-xl font-bold text-primary-orange">Panels (AddPanale)</h2>
                <div class="flex gap-2">
                    <button id="panale-refresh" class="px-3 py-1 bg-primary-orange text-white rounded">Refresh</button>
                </div>
            </div>

            <div id="panale-error" class="text-red-600 mb-2" style="display:none"></div>
            <div id="panale-success" class="text-green-600 mb-2" style="display:none"></div>

            <!-- Create / Update Form -->
            <div class="mb-4 grid grid-cols-1 md:grid-cols-4 gap-3 items-end">
                <div>
                    <label class="block text-sm text-gray-600">ID (read-only for update)</label>
                    <input id="panale-id" class="w-full mt-1 p-2 border rounded bg-gray-50" readonly />
                </div>
                <div>
                    <label class="block text-sm text-gray-600">Linkup Key</label>
                    <input id="panale-linkupKey" class="w-full mt-1 p-2 border rounded" />
                </div>
                <div>
                    <label class="block text-sm text-gray-600">Images</label>
                    <input id="panale-images" class="w-full mt-1 p-2 border rounded" />
                </div>
                <div class="flex items-center gap-3">
                    <label class="flex items-center gap-2"><input id="panale-active" type="checkbox" checked /> Active</label>
                    <div class="ml-auto flex gap-2">
                        <button id="panale-save" class="px-3 py-1 bg-green-600 text-white rounded">Save</button>
                        <button id="panale-cancel" class="px-3 py-1 bg-gray-200 rounded">Clear</button>
                    </div>
                </div>
            </div>

            <div id="panale-list" class="space-y-3">
                <div class="text-gray-500">Loading panels...</div>
            </div>
        </section>
    </div>

    <script>
        /**
         * Fetches data from an API and updates the content of the first dashboard card.
         */
        async function updateMetricsCard() {
            // !!! IMPORTANT: Replace this with your actual API endpoint !!!
            const apiEndpoint = 'YOUR_API_ENDPOINT_HERE';

            // Fallback data for demonstration if the API fails
            const fallbackData = {
                title: "Name of user",
                value: 0,
            };

            try {
                // Fetch data from the API
                const response = await fetch(apiEndpoint);

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();

                // Get references to the HTML elements
                const titleElement = document.getElementById('metric-title');
                const valueElement = document.getElementById('metric-value');

                // Update the content
                if (titleElement) {
                    titleElement.textContent = data.title || fallbackData.title;
                }
                if (valueElement) {
                    // Format the number (e.g., 4500 -> 4,500)
                    const formattedValue = data.value ? data.value.toLocaleString() : fallbackData.value.toLocaleString();
                    valueElement.textContent = formattedValue;
                }

            } catch (error) {
                console.error('There was a problem with the fetch operation. Using fallback data.', error);
                
                // Use fallback data on error
                const titleElement = document.getElementById('metric-title');
                const valueElement = document.getElementById('metric-value');
                if (titleElement) {
                    titleElement.textContent = fallbackData.title;
                }
                if (valueElement) {
                    valueElement.textContent = fallbackData.value.toLocaleString();
                }
            }
        }
        
        async function updatePhoneNumber() {
            // !!! IMPORTANT: Replace this with your actual API endpoint !!!
            const apiEndpoint = 'YOUR_API_ENDPOINT_HERE';

            // Fallback data for demonstration if the API fails
            const fallbackData = {
                title: "marwan",
                value: 987654321,
            };

            try {
                // Fetch data from the API
                const response = await fetch(apiEndpoint);

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();

                // Get references to the HTML elements
                const titleElement = document.getElementById('phone-title');
                const valueElement = document.getElementById('phone-value');

                // Update the content
                if (titleElement) {
                    titleElement.textContent = data.PhoneNumber || fallbackData.title;
                }
                if (valueElement) {
                    // Format the number (e.g., 4500 -> 4,500)
                    const formattedValue = data.value ? data.value.toLocaleString() : fallbackData.value.toLocaleString();
                    valueElement.textContent = formattedValue;
                }

            } catch (error) {
                console.error('There was a problem with the fetch operation. Using fallback data.', error);
                
                // Use fallback data on error
                const titleElement = document.getElementById('phone-title');
                const valueElement = document.getElementById('phone-value');
                if (titleElement) {
                    titleElement.textContent = fallbackData.title;
                }
                if (valueElement) {
                    valueElement.textContent = fallbackData.value.toLocaleString();
                }
            }
        }
        /**
         * Simple logout handler that redirects back to the index (login) page.
         */
        function handleLogout(event) {
            event.preventDefault();
            // In a real app, you would clear auth tokens or session data here.
            console.log("User logged out successfully.");
            window.location.href = 'index.html';
        }

        // Call the API function when the entire page content is loaded
        document.addEventListener('DOMContentLoaded', updateMetricsCard);
        document.addEventListener('DOMContentLoaded', updatePhoneNumber);
        document.addEventListener('DOMContentLoaded', loadPanaleList);

        // Load AddPanale list and wire delete/refresh/create/update
        const PANALE_BASE = 'https://ems-api.mataaa.com/gateway/CatalogManagement/api/v1/AddPanale';

        async function loadPanaleList() {
            const listEl = document.getElementById('panale-list');
            const errEl = document.getElementById('panale-error');
            const successEl = document.getElementById('panale-success');
            if (!listEl) return;
            listEl.innerHTML = '<div class="text-gray-500">Loading panels...</div>';
            errEl.style.display = 'none'; errEl.textContent = '';
            successEl.style.display = 'none'; successEl.textContent = '';

            try {
                // Note: your cURL examples included a Cookie header. Browsers will only send cookies for that domain
                // if they were previously set and CORS allows credentials. If requests fail due to CORS/auth, use Postman
                // or a server-side proxy that adds the Cookie header.
                const url = `${PANALE_BASE}?Page=1&PostsPerPage=50`;
                const res = await fetch(url, { headers: { accept: '*/*' } });
                if (!res.ok) throw new Error('Network response was not ok: ' + res.status);
                const data = await res.json();

                // common response shapes: { items: [...] } or top-level array
                const items = Array.isArray(data) ? data : (data.items || data.data || []);

                if (!items || items.length === 0) {
                    listEl.innerHTML = '<div class="text-gray-600">No panels found.</div>';
                    return;
                }

                listEl.innerHTML = '';
                items.forEach((it) => {
                    const id = it.id || it.guid || it;
                    const wrapper = document.createElement('div');
                    wrapper.className = 'p-3 border rounded flex items-center justify-between';

                    const left = document.createElement('div');
                    left.innerHTML = `<div class="font-semibold">${escapeHtml(it.linkupKey || '(no key)')}</div><div class="text-sm text-gray-600">${escapeHtml(it.images || '')}</div>`;

                    const right = document.createElement('div');
                    right.className = 'flex gap-2';
                    const editBtn = document.createElement('button');
                    editBtn.textContent = 'Edit';
                    editBtn.className = 'px-2 py-1 bg-blue-600 text-white rounded text-sm';
                    editBtn.onclick = () => populateForm(it);

                    const delBtn = document.createElement('button');
                    delBtn.textContent = 'Delete';
                    delBtn.className = 'px-2 py-1 bg-red-600 text-white rounded text-sm';
                    delBtn.onclick = () => deletePanale(id, wrapper);

                    right.appendChild(editBtn);
                    right.appendChild(delBtn);

                    wrapper.appendChild(left);
                    wrapper.appendChild(right);
                    listEl.appendChild(wrapper);
                });

            } catch (err) {
                errEl.style.display = 'block';
                errEl.textContent = 'Failed to load panels: ' + (err.message || err);
                listEl.innerHTML = '<div class="text-gray-600">Unable to load panels.</div>';
                console.error(err);
            }
        }

        async function deletePanale(id, nodeToRemove) {
            if (!confirm('Delete this panel?')) return;
            const errEl = document.getElementById('panale-error');
            errEl.style.display = 'none'; errEl.textContent = '';
            try {
                const url = `${PANALE_BASE}/${id}`;
                const res = await fetch(url, { method: 'DELETE', headers: { accept: '*/*' } });
                if (!res.ok) {
                    const text = await res.text().catch(() => '');
                    throw new Error('Delete failed: ' + res.status + ' ' + text);
                }
                // remove from DOM
                if (nodeToRemove && nodeToRemove.parentNode) nodeToRemove.parentNode.removeChild(nodeToRemove);
                // clear form if it was editing this ID
                const currentId = document.getElementById('panale-id').value;
                if (currentId && (currentId === id || currentId === String(id))) clearForm();
            } catch (err) {
                errEl.style.display = 'block';
                errEl.textContent = 'Delete failed: ' + (err.message || err);
                console.error(err);
            }
        }

        async function savePanale() {
            const errEl = document.getElementById('panale-error');
            const successEl = document.getElementById('panale-success');
            errEl.style.display = 'none'; errEl.textContent = '';
            successEl.style.display = 'none'; successEl.textContent = '';

            const id = document.getElementById('panale-id').value.trim();
            const linkupKey = document.getElementById('panale-linkupKey').value.trim();
            const images = document.getElementById('panale-images').value.trim();
            const isActive = document.getElementById('panale-active').checked;

            const payload = { isActive, images, linkupKey };

            try {
                if (id) {
                    // update
                    const url = `${PANALE_BASE}/${id}`;
                    const res = await fetch(url, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json', accept: '*/*' },
                        body: JSON.stringify(payload),
                    });
                    if (!res.ok) throw new Error('Update failed: ' + res.status);
                    successEl.style.display = 'block'; successEl.textContent = 'Updated successfully';
                } else {
                    // create
                    const res = await fetch(PANALE_BASE, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json', accept: '*/*' },
                        body: JSON.stringify(payload),
                    });
                    if (!res.ok) throw new Error('Create failed: ' + res.status);
                    successEl.style.display = 'block'; successEl.textContent = 'Created successfully';
                }
                clearForm();
                await loadPanaleList();
            } catch (err) {
                errEl.style.display = 'block';
                errEl.textContent = (err.message || err);
                console.error(err);
            }
        }

        function populateForm(it) {
            document.getElementById('panale-id').value = it.id || it.guid || '';
            document.getElementById('panale-linkupKey').value = it.linkupKey || '';
            document.getElementById('panale-images').value = it.images || '';
            document.getElementById('panale-active').checked = Boolean(it.isActive);
            // scroll into view
            document.getElementById('panale-id').scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        function clearForm() {
            document.getElementById('panale-id').value = '';
            document.getElementById('panale-linkupKey').value = '';
            document.getElementById('panale-images').value = '';
            document.getElementById('panale-active').checked = true;
            document.getElementById('panale-error').style.display = 'none';
            document.getElementById('panale-success').style.display = 'none';
        }

        document.getElementById('panale-refresh')?.addEventListener('click', loadPanaleList);
        document.getElementById('panale-save')?.addEventListener('click', savePanale);
        document.getElementById('panale-cancel')?.addEventListener('click', (e) => { e.preventDefault(); clearForm(); });

        // Simple HTML escaper
        function escapeHtml(s) {
            if (!s) return '';
            return String(s).replace(/[&<>\"']/g, function (c) {
                return ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;' })[c];
            });
        }
    </script>
</body>
</html>